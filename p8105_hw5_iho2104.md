p8105_hw5_iho2104
================
Ixtaccihuatl Obregon
2023-11-15

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.3     ✔ readr     2.1.4
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.0
    ## ✔ ggplot2   3.4.3     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.2     ✔ tidyr     1.3.0
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(dplyr)
library(purrr)
library(ggplot2)
library(broom)
```

## Problem One

## Problem Two

``` r
## CON
file_paths_c = list.files("data", pattern = "con_\\d+\\.csv", full.names = TRUE)
controls = map_dfr(file_paths_c, read.csv) |> 
  mutate(id = c("con_01", "con_02", "con_03", "con_04", "con_05", "con_06", "con_07", "con_08", "con_09", "con_10" )) |> 
  select(id, everything()) 

## EXP
file_paths_e = list.files("data", pattern = "exp_\\d+\\.csv", full.names = TRUE)
exp = map_dfr(file_paths_e, read.csv) |> 
  mutate(id = c("exp_01", "exp_02", "exp_03", "exp_04", "exp_05", "exp_06", "exp_07", "exp_08", "exp_09", "exp_10" )) |> 
  select(id, everything()) 

# combined arms 
df = rbind(controls, exp) |> 
  separate(col = id, into = c("arm", "id"), sep = "_") |> 
  pivot_longer(cols = starts_with("week"), names_to = "week", values_to = "value") 

df_plot = df |> 
  mutate(sub_id = paste(arm, id, sep = "_"))

# spaghetti plot 
df_plot |> 
  ggplot(aes(x = week, y = value, group = sub_id, color = arm)) +
  geom_line() +
  labs(title = "Spaghetti Plot", x = "Time", y = "Value")
```

![](p8105_hw5_iho2104_files/figure-gfm/unnamed-chunk-3-1.png)<!-- -->

## Problem Three

Following chunk attempted to integrate a for loop and function to obtain
3500 observations consisting of variables: mu, iteration, estimate, and
p.value.

``` r
fix_n = 30 
fix_sigma = 5 
mu_val= c(0,1,2,3,4,5,6)
datasets = vector("list", length = 5000)

for (i in 1:5000) {
  dataset = rnorm(fix_n, mean = mu_val, sd = fix_sigma) # Generate a dataset
  t_test_results = lapply(mu_val, function(mu) {      # Function
  t_test_result = t.test(dataset, mu = mu)            # Perform t-test
  tidy_result = tidy(t_test_result)                   # Extract estimates and p-value 
  tibble::tibble(estimate = tidy_result$estimate[1],  # Assuming one-sided t-test
                   p_value = tidy_result$p.value[1])  # Assuming one-sided t-test
})
  
datasets[[i]] = do.call(rbind, t_test_results) 
}

results_df = do.call(rbind, datasets)
results_df = mutate(results_df, estimate = sub("sub_str", "", estimate)) |> 
select(estimate, p_value)
head(results_df)
```

I used the for-loop 7 times to generate my dataframe with 35000 obs and
4 variables.

``` r
#mu_val = 0 
fix_n = 30
fix_sigma = 5
mu = 0
datasets <- vector("list", length = 5000)

for (i in 1:5000) {
  dataset = rnorm(fix_n, mean = mu, sd = fix_sigma)
  t_test_result = t.test(dataset, mu = mu)
  tidy_result = broom::tidy(t_test_result)
  datasets[[i]] = tibble::tibble(
    mu = mu, 
    iteration = i, 
    estimate = tidy_result$estimate[1],
    p_value = tidy_result$p.value[1])
}


results_df_0 = do.call(rbind, datasets)


results_df_0 = mutate(results_df_0, estimate = sub("sub_str", "", estimate))  # Remove sub_str from estimate
results_df_0 = results_df_0 |> 
  select(mu, iteration,estimate, p_value)

head(results_df_0)
```

    ## # A tibble: 6 × 4
    ##      mu iteration estimate             p_value
    ##   <dbl>     <int> <chr>                  <dbl>
    ## 1     0         1 0.239407711659577      0.766
    ## 2     0         2 -1.09905454406129      0.207
    ## 3     0         3 -0.141628878345606     0.853
    ## 4     0         4 -0.00262938900164021   0.998
    ## 5     0         5 0.603900764763519      0.576
    ## 6     0         6 0.440543317218614      0.675

``` r
#mu_val = 1
fix_n = 30
fix_sigma = 5
mu = 1
datasets <- vector("list", length = 5000)

for (i in 1:5000) {
  dataset = rnorm(fix_n, mean = mu, sd = fix_sigma)
  t_test_result = t.test(dataset, mu = mu)
  tidy_result = broom::tidy(t_test_result)
  datasets[[i]] = tibble::tibble(
    mu = mu, 
    iteration = i, 
    estimate = tidy_result$estimate[1],
    p_value = tidy_result$p.value[1])
}

results_df_1 = do.call(rbind, datasets)
results_df_1 = mutate(results_df_1, estimate = sub("sub_str", "", estimate))
results_df_1 = results_df_1 |> 
  select(mu, iteration,estimate, p_value)

head(results_df_1)
```

    ## # A tibble: 6 × 4
    ##      mu iteration estimate           p_value
    ##   <dbl>     <int> <chr>                <dbl>
    ## 1     1         1 1.62153047999972     0.480
    ## 2     1         2 0.0419179377906904   0.334
    ## 3     1         3 -0.236765847013338   0.128
    ## 4     1         4 0.46595059266779     0.578
    ## 5     1         5 1.96038417194859     0.253
    ## 6     1         6 0.446595127898316    0.509

``` r
#mu_val = 2
fix_n = 30
fix_sigma = 5
mu = 2
datasets <- vector("list", length = 5000)

for (i in 1:5000) {
  dataset = rnorm(fix_n, mean = mu, sd = fix_sigma)
  t_test_result = t.test(dataset, mu = mu)
  tidy_result = broom::tidy(t_test_result)
  datasets[[i]] = tibble::tibble(
    mu = mu, 
    iteration = i, 
    estimate = tidy_result$estimate[1],
    p_value = tidy_result$p.value[1])
}

results_df_2 = do.call(rbind, datasets)
results_df_2 = mutate(results_df_2, estimate = sub("sub_str", "", estimate))
results_df_2 = results_df_2 |> 
  select(mu, iteration,estimate, p_value)

head(results_df_2)
```

    ## # A tibble: 6 × 4
    ##      mu iteration estimate          p_value
    ##   <dbl>     <int> <chr>               <dbl>
    ## 1     2         1 0.322455658902968  0.0701
    ## 2     2         2 1.43594476125283   0.579 
    ## 3     2         3 2.5200885854105    0.544 
    ## 4     2         4 1.65703579981159   0.739 
    ## 5     2         5 1.82872524122176   0.829 
    ## 6     2         6 2.77606517229219   0.498

``` r
#mu_val = 3
fix_n = 30
fix_sigma = 5
mu = 3
datasets <- vector("list", length = 5000)

for (i in 1:5000) {
  dataset = rnorm(fix_n, mean = mu, sd = fix_sigma)
  t_test_result = t.test(dataset, mu = mu)
  tidy_result = broom::tidy(t_test_result)
  datasets[[i]] = tibble::tibble(
    mu = mu, 
    iteration = i, 
    estimate = tidy_result$estimate[1],
    p_value = tidy_result$p.value[1])
}

results_df_3 = do.call(rbind, datasets)
results_df_3 = mutate(results_df_3, estimate = sub("sub_str", "", estimate))
results_df_3 = results_df_3 |> 
  select(mu, iteration,estimate, p_value)

head(results_df_3)
```

    ## # A tibble: 6 × 4
    ##      mu iteration estimate         p_value
    ##   <dbl>     <int> <chr>              <dbl>
    ## 1     3         1 2.85402911338682   0.890
    ## 2     3         2 3.40285340079337   0.694
    ## 3     3         3 3.27352910348056   0.722
    ## 4     3         4 2.94915340658134   0.938
    ## 5     3         5 3.52771535263445   0.534
    ## 6     3         6 4.50012515586573   0.133

``` r
#mu_val = 4
fix_n = 30
fix_sigma = 5
mu = 4
datasets <- vector("list", length = 5000)

for (i in 1:5000) {
  dataset = rnorm(fix_n, mean = mu, sd = fix_sigma)
  t_test_result = t.test(dataset, mu = mu)
  tidy_result = broom::tidy(t_test_result)
  datasets[[i]] = tibble::tibble(
    mu = mu, 
    iteration = i, 
    estimate = tidy_result$estimate[1],
    p_value = tidy_result$p.value[1])
}

results_df_4 = do.call(rbind, datasets)
results_df_4 = mutate(results_df_4, estimate = sub("sub_str", "", estimate))
results_df_4 = results_df_4 |> 
  select(mu, iteration,estimate, p_value)

head(results_df_4)
```

    ## # A tibble: 6 × 4
    ##      mu iteration estimate         p_value
    ##   <dbl>     <int> <chr>              <dbl>
    ## 1     4         1 3.08215190833567  0.320 
    ## 2     4         2 3.57718946969058  0.665 
    ## 3     4         3 5.58508426014883  0.112 
    ## 4     4         4 3.69960824023621  0.761 
    ## 5     4         5 4.54184045826656  0.495 
    ## 6     4         6 1.97709343519117  0.0131

``` r
#mu_val = 5
fix_n = 30
fix_sigma = 5
mu = 5
datasets <- vector("list", length = 5000)

for (i in 1:5000) {
  dataset = rnorm(fix_n, mean = mu, sd = fix_sigma)
  t_test_result = t.test(dataset, mu = mu)
  tidy_result = broom::tidy(t_test_result)
  datasets[[i]] = tibble::tibble(
    mu = mu, 
    iteration = i, 
    estimate = tidy_result$estimate[1],
    p_value = tidy_result$p.value[1])
}

results_df_5 = do.call(rbind, datasets)
results_df_5 = mutate(results_df_5, estimate = sub("sub_str", "", estimate))
results_df_5 = results_df_5 |> 
  select(mu, iteration,estimate, p_value)

head(results_df_5)
```

    ## # A tibble: 6 × 4
    ##      mu iteration estimate         p_value
    ##   <dbl>     <int> <chr>              <dbl>
    ## 1     5         1 3.6845707200964    0.132
    ## 2     5         2 5.69750868904734   0.506
    ## 3     5         3 6.54899155056971   0.106
    ## 4     5         4 4.42931690581233   0.532
    ## 5     5         5 4.04373986330143   0.197
    ## 6     5         6 6.63963966462062   0.105

``` r
#mu_val = 6
fix_n = 30
fix_sigma = 5
mu = 6
datasets <- vector("list", length = 5000)

for (i in 1:5000) {
  dataset = rnorm(fix_n, mean = mu, sd = fix_sigma)
  t_test_result = t.test(dataset, mu = mu)
  tidy_result = broom::tidy(t_test_result)
  datasets[[i]] = tibble::tibble(
    mu = mu, 
    iteration = i, 
    estimate = tidy_result$estimate[1],
    p_value = tidy_result$p.value[1])
}

results_df_6 = do.call(rbind, datasets)
results_df_6 = mutate(results_df_6, estimate = sub("sub_str", "", estimate))
results_df_1 = results_df_6 |> 
  select(mu, iteration,estimate, p_value)

head(results_df_6)
```

    ## # A tibble: 6 × 4
    ##      mu iteration estimate         p_value
    ##   <dbl>     <int> <chr>              <dbl>
    ## 1     6         1 7.23701518241185   0.185
    ## 2     6         2 5.67862891497095   0.704
    ## 3     6         3 5.4321577057908    0.422
    ## 4     6         4 6.47407095399195   0.579
    ## 5     6         5 7.18746090132722   0.220
    ## 6     6         6 5.85698105170744   0.864

``` r
combined_results = rbind(results_df_0, results_df_1, results_df_2, results_df_3, results_df_4, results_df_5, results_df_6)
```

Make a plot showing the proportion of times the null was rejected (the
power of the test) on the y axis and the true value of μ on the x axis.
Describe the association between effect size and power.
